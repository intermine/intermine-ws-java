<!-- 

	Ant script to produce distribution zip with webservice client libraries and samples.
	To build, run 'ant -f <path-to-this-file>'.
    Generated distribution zip file is saved in directory that is set in this build file
    under dist.dir property.

-->
<project name="intermine-webservice-client" basedir="." default="dist">

  <property name="dist.dir" value="client-dist" />
  <property name="src.dir" value="src" />
  <property name="build.dir" value="client-build" />
  <property name="javadoc.author" value="InterMine team" />
  <property name="version" value="1.1" />
  
  <target name="clean">
    <delete dir="${dist.dir}" failonerror="false"/>
    <delete dir="${build.dir}" failonerror="false"/>
  </target>
  
  <target name="compile">
    <!-- Calling standard InterMine build scripts -->
    <ant antfile="build.xml" target="library.jar" inheritall="false"></ant>
    <ant antfile="../../pathquery/main/build.xml" target="library.jar" dir="../../../pathquery/main" inheritall="false"/> 
    <ant antfile="../../objectstore/main/build.xml" target="library.jar" dir="../../../objectstore/main" inheritall="false"></ant>
  </target>
  
  <target name="javadoc">
    <ant antfile="../../pathquery/main/build.xml" target="javadoc" dir="../../../pathquery/main" inheritall="false"/>
    <copydir dest="${build.dir}/doc/javadoc-pathquery" src="../../../pathquery/main/build/javadoc"></copydir>
    <javadoc destdir="${build.dir}/doc/javadoc-client" source="${src.dir}" notree="true" use="false" nonavbar="false" noindex="false" 
	     splitindex="false" author="${javadoc.author}" version="false" failonerror="false">
      <sourcepath>
	<pathelement location="${src.dir}" />
      </sourcepath>
    </javadoc> 
  </target>
  
  <target name="build" depends="clean, compile">
    <mkdir dir="${build.dir}"/>
    <copydir dest="${build.dir}/src" src="src" />
    <copydir dest="${build.dir}/lib" src="lib" />
    <!--intermine-webservice-client.jar was created before by calling InterMine build script  -->
    <jar destfile="${build.dir}/lib/intermine-client.jar">
      <zipfileset src="dist/intermine-webservice-client.jar" />
      <fileset file="${src.dir}/log4j.properties" />
    </jar>
    <copyfile dest="${build.dir}/lib/intermine-pathquery.jar" src="../../../pathquery/main/dist/intermine-pathquery.jar"/> 
    <copyfile dest="${build.dir}/lib/intermine-objectstore.jar" src="../../../objectstore/main/dist/intermine-objectstore.jar"/>
    <!-- stax-api-1.0.jar and stax-ri-1.0.jar is needed when java 1.5 is used for pathquery XML serialization and deserialization -->
    <copyfile dest="${build.dir}/lib/stax-api-1.0.jar" src="../../../pathquery/main/lib/stax-api-1.0.jar"/>
    <copyfile dest="${build.dir}/lib/stax-ri-1.0.jar" src="../../../pathquery/main/lib/stax-ri-1.0.jar"/>
    <copyfile dest="${build.dir}/lib/commons-lang-2.3.jar" src="../../../objectstore/main/lib/commons-lang-2.3.jar"/>
    <copyfile dest="${build.dir}/lib/antlr-2.7.6-caching.jar" src="../../../objectstore/main/lib/antlr-2.7.6-caching.jar"/>
    <copydir dest="${build.dir}/samples" src="../samples" excludes=".*, bin/**"></copydir>
    <copyfile dest="${build.dir}/README.txt" src="README.txt"/>
  </target>

  <target name="dist" depends="build, javadoc">
    <mkdir dir="${dist.dir}"/>
    <zip destfile="${dist.dir}/intermine-client-${version}.zip" >
      <zipfileset dir="${build.dir}" excludes="samples/compile-run.sh" prefix="intermine-client-${version}" />
      <zipfileset dir="${build.dir}" includes="samples/compile-run.sh" filemode="755" prefix="intermine-client-${version}"/>
    </zip>
  </target>
</project>
