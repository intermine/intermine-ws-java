<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"
            type="text/javascript"></script>
        <!--[if IE]><script language="javascript" type="text/javascript" src="lib/flot/excanvas.min.js"></script><![endif]-->
        <script language="javascript" type="text/javascript" src="lib/flot/jquery.flot.js"></script>
        <script language="javascript" type="text/javascript" src="lib/flot/jquery.flot.stack.js"></script>

        <script src="http://jquery-jsonp.googlecode.com/files/jquery.jsonp-2.1.4.min.js" type="text/javascript"></script>
        <script src="src/imbedding.js" type="text/javascript"></script>
        <script src="lib/jquery-ui-1.8.9.custom.min.js" type="text/javascript"></script>
        <script src="lib/jquery-syntax/jquery.syntax.js" type="text/javascript"></script>
        <script src="lib/tutorial.js" type="text/javascript"></script>
        <link href='http://fonts.googleapis.com/css?family=Vollkorn' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Cuprum' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Neuton' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Droid+Sans+Mono' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" type="text/css" href="lib/css/flick/jquery-ui-1.8.9.custom.css" />
        <link rel="stylesheet" type="text/css" href="lib/jquery-syntax/jquery.syntax.layout.list.css" />
        <link rel="stylesheet" type="text/css" href="lib/jquery-syntax/jquery.syntax.core.css" />
        <link rel="alternate stylesheet" type="text/css" title="dark" href="style/dark.css" />
        <link rel="alternate stylesheet" type="text/css" title="light" href="style/light.css" />
        <link rel="stylesheet" type="text/css" title="bold" href="style/bold.css" />
        <link rel="stylesheet" type"text/css" href="style/tutorial.css"/>
        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
    </head>
    <body>
        <div id="page">
        <h1 style="text-align: center;" >InterMine Mashup Tutorial</h1>
    <div id="dialog-confirm" title="Delete the current query?">
        <p>
        <span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>
        Changing the root class will clear your current query - are you sure?
        </p>
    </div>

<div id="tabs">
    <ul>
        <li><a href="#tabs-1">The Basics</a></li>
        <li><a href="#tabs-3">Templates</a></li>
        <li><a href="#tabs-2">Arbitrary Queries</a></li>
        <li><a href="#tabs-4">Doing Other Things with Results</a></li>
        <li><a href="#tabs-7">Styling Tables</a></li>
        <li><a href="#tabs-5">Resources</a></li>
        <li><a href="#tabs-6">FAQ</a></li>
    </ul>


    <div id="tabs-1">
        <h2>The basics</h2>
        <p>
        You can now embed results from InterMine queries directly into your own web pages.
        All you need for this is a little knowledge of javascript - and there is a 
        JavaScript client library available so you really do need only a little. If you 
        want to do more, the techniques shown here are flexible and powerful enough
        to present information in any way you choose.
        </p>
        <h2>Example</h2>
        <p>
        Below you can see a table with results from the FlyMine preview site. On page
        ready the table structure was loaded in and the mine was queried for the count.
        The default behaviour is for results to be loaded into tables with only the title and 
        count showing. Clicking the table will expand it, causing it to fetch data rows
        from the mine and insert them into itself, allowing you to see its contents. 
        </p>
        <div id="placeholder1"><p>This will be where the table goes</p></div>
        <p>
        As you can see, you do not need a lot of code to get this effect:
        <p>
            <textarea rows="20" cols="80" class="coder html-snippet">
<div id="placeholder1"></div>
<script type="text/javascript">
    IMBedding.setBaseUrl("http://preview.flymine.org/preview");
    IMBedding.loadTemplate(
        {
            name:           "Gene_RegionOverlappingTFbindingsite",

            constraint1:    "Gene",
            op1:            "LOOKUP",
            value1:         "CG2328",
            code1:          "A",
        },            
        '#placeholder1',
    );
</script></textarea>
            <p>
            Go <a href="demo.html" target="_blank" >here</a> to see a very simple demo of 
            the techniques shown on this page.
            <p>
            <input type="checkbox" id="demoSourceCB" onclick="$('#demo').slideToggle();"/><label for="demoSourceCB">View The Source For a Complete Working Example</label>

        <div id="demo" style="display: none;">
            <textarea rows="20" cols="80" class="coder html-snippet">
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <title>A Minimal Example Page</title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <!-- jQuery is hosted by Google -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" 
        type="text/javascript">
    </script>
    <!-- jquery-jsonp is likewise available from an online repository -->
    <script src="http://jquery-jsonp.googlecode.com/files/jquery.jsonp-2.1.4.min.js" 
        type="text/javascript">
    </script>
    <!-- InterMine similarly hosts imbedding -->
    <script src="http://intermine.org/download/imbedding/0.1/imbedding.min.js" 
        type="text/javascript">
    </script>
    <link rel="stylesheet" type="text/css" 
        href="http://intermine.org/download/imbedding/0.1/style/bold.css" />
</head>

<body>
    <div id="placeholder"></div>
</body>

<script type="text/javascript">
    IMBedding.setBaseUrl("http://squirrel.flymine.org/intermine-test");
    IMBedding.loadTemplate(
        {
            name:           "ManagerLookup",
            size:           10,
        
            constraint1:    "Manager",
            op1:            "LOOKUP",
            value1:         "*",
            code1:          "A",
        },
        '#placeholder'
    );
</script>

</html></textarea>
</div>
        <h2 id="boilerplate">How To Set This Up</h2>
        <p>
        We have tried to keep the boilerplate you need to put into your code to a minimum, but
        there are a few things you need:
        <ul>
            <li class="resource"><h3>Some javascript libraries.</h3>
            <p>
            To use the InterMine Embedding library (imbedding.js), you will need to <a 
            href="#boilerplate" onclick="$('#librariesHead').slideToggle();">include</a>
            the following scripts into your page: 
            <a href="www.jquery.com">jQuery</a>,
            <a href="http://code.google.com/p/jquery-jsonp/">jQuery-JSONP</a> and 
            <a href="http://intermine.org/download/imbedding/">imbedding.js library</a>.
            </p>
            <div id="librariesHead" style="display: none;">
                <p>
                You do not need to download them, just add the following lines to the 
                head of the page:
                </p>
                <textarea rows="20" cols="80" class="coder html-snippet">
<head>
    <!-- jQuery is hosted by Google -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" 
        type="text/javascript">
    </script>
    <!-- jquery-jsonp is likewise available from an online repository -->
    <script src="http://jquery-jsonp.googlecode.com/files/jquery.jsonp-2.1.4.min.js" 
        type="text/javascript">
    </script>
    <!-- Similarly imbedding.js is hosted on intermine.org -->
    <script src="http://www.intermine.org/download/imbedding/0.1/imbedding.min.js" 
        type="text/javascript">
    </script>
</head>
                </textarea>
            </div>
            </li>
            <li class="resource"><h3>Some css styles</h3>
            <p>
            To style the tables, you will also need to include some css with the <a 
            href="#boilerplate" onclick="$('#classlist').slideToggle();">appropriate classes.</a>
            <div id="classlist" style="display: none;">
            <span class="normal-color">Classes you can style in an embedded table:</a>
            <ul>
                <li class="resource">.imbedded-table-container: <span class="normal-color">The outer container that holds the table</span></li>
                <li class="resource">.imbedded-table-titlebox: <span class="normal-color">The box that holds the title and count</span></li>
                <li class="resource">.imbedded-table-title: <span class="normal-color">The text with the actual title</span></li>
                <li class="resource">.imbedded-table: <span class="normal-color">The table element</span></li>
                <li class="resource">.imbedded-column-header-row: <span class="normal-color">The row with the column headings</span></li>
                <li class="resource">.imbedded-cell: <span class="normal-color">Each cell of the table</span></li>
                <li class="resource">.imbedded-row-odd: <span class="normal-color">Odd numbered table rows</span></li>
                <li class="resource">.imbedded-row-even: <span class="normal-color">Even numbered table rows</span></li>
            <li class="resource">.imbedded-column-odd: <span class="normal-color">Odd numbered table columns</span></li>
            <li class="resource">.imbedded-column-even: <span class="normal-color">Even numbered table columns</span></li>
                <li class="resource">.imbedded-exportlink: <span class="normal-color">The CSV and TSV export links</span></li>
                <li class="resource">.imbedded-pagelink: <span class="normal-color">The previous/next paging links</span></li>
                <li class="resource">.imbedded-mineresultslink: <span class="normal-color">The link to the results in the originating mine</span></li>
                <li class="resource">.imbedded-prev: <span class="normal-color">The previous paging link</span></li>
                <li class="resource">.imbedded-next: <span class="normal-color">The next paging link</span></li>
            </ul>
            <p>
            There are some stylesheets available (all the ones used on this page) via the 
            web-hosting interface as well.
            </p>
            <textarea rows="20" cols="80" class="coder html-snippet">
<head>
    <!-- You are welcome to fetch these styles from the intermine host -->
    <link rel="stylesheet" href="http://www.intermine.org/download/imbedding/0.1/style/bold.css" />
</head>
            </textarea>
            </div>
            </li>
            <li class="resource"><h3>A placeholder (or several) on the page</h3>
            <p>
            You will need to include <a href="#boilerplate" onclick="$('#placeholder-snippet').slideToggle();">an element</a> to tell the table where to go.
            </p>
            <div id="placeholder-snippet" style="display: none;">
            <textarea rows="20" cols="80" class="coder html-snippet">
<body>
    <div id="placeholder">The content of this div will be replaced by the table</div>
</body>
            </textarea>
            <p>
            Using placeholders means you can be precise about where you want your tables to
            appear on the page, and have as many of them as you want, without interference
            between them.
            </p><p>
            Placeholders also mean graceful fallback - simply supply alternative fallback
            material within the placeholder element: it will be overwritten when the table goes
            in.
            </p>
            <button id="positionExButton">Replace the placeholder element below with a table</button>
            </p>
            <div id="positionExample">
                <div style="border: solid 3px #0073EA;">
                <p>
                <span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>
                Terribly sorry there is no pretty table to see here. Maybe you
                don't have JavaScript enabled? No worries, just go through to
                <a href="http://www.flymine.org">FlyMine</a> for all the data you can eat
                </p>
                </div>
            </div>
        </div>
            <li class="resource"><h3>A Script to load the table in</h3>
            <p>
            You can either write your own separate library of functions and include it in your 
            head, or you can insert <a href="#boilerplate" 
            onclick="$('#scriptElem').slideToggle();">a script element</a> directly into the page:
            </p>
            <div id="scriptElem" style="display: none;">
            <textarea rows="20" cols="80" class="coder html-snippet">
<script type="text/javascript">
    IMBedding.setBaseUrl("http://squirrel.flymine.org/intermine-test");
    IMBedding.loadTemplate(
        {
            name:           "ManagerLookup",
            size:           10,
        
            constraint1:    "Manager",
            op1:            "LOOKUP",
            value1:         "*",
            code1:          "A",
        },
        '#placeholder1'
    );
</script>
</textarea>
</div>
            </li>
        </ul>
        <h2>Showing Contents on Load</h2>
        <p>
        Various features of the table are configurable via options. The table below was loaded 
        with the option "openOnLoad" set to true. Clicking on the titlebar of this
        table will collapse it.
        </p>
        <div id="placeholderEx2"><p>This will be where the table goes</p></div>
        <input type="checkbox" id="example2CB" onclick="$('#example2').slideToggle();"/><label for="example2CB">View Source</label>
        <div id="example2" style="display: none;">
            <textarea rows="20" cols="80" class="coder html-snippet">
<script type="text/javascript">
    IMBedding.setBaseUrl("http://preview.flymine.org/preview");
    IMBedding.loadTemplate(
        {
            name:           "Gene_Identifiers",

            constraint1:    "Gene.secondaryIdentifier",
            op1:            "<",
            value1:         "CG1046",
            code1:          "A",
        },
        "#placeholderEx2",
        {openOnLoad: true}
    );
</script></textarea>
        </div>
        <h2>Changing Title Click Behaviour</h2>
        <p>
        The default behaviour for a click on the title is to expand/collapse the table. 
        You can choose other behaviours:
        </p>
        <h3>Click Through to Mine</h3>
        <div id="placeholderEx3a"><p>This will be where the table goes</p></div>
        <h3>No Behaviour</h3>
        <div id="placeholderEx3b"><p>This will be where the table goes</p></div>
        <input type="checkbox" id="example3CB" onclick="$('#example3').slideToggle();"/><label for="example3CB">View Source</label>
        <div id="example3" style="display: none;">
            <textarea rows="20" cols="80" class="coder html-snippet">
<script type="text/javascript">
    IMBedding.setBaseUrl("http://preview.flymine.org/preview");
    IMBedding.loadTemplate(
        {
            name:           "Gene_allGOTerms2",

            constraint1:    "Gene",
            op1:            "LOOKUP",
            value1:         "CG11348",
            code1:          "A",
        },
        "#placeholderEx3a",
        {onTitleClick: "mine"}
    );
    IMBedding.loadTemplate(
        {
            name:           "Gene_allGOTerms2",
            size: 10,

            constraint1:    "Gene",
            op1:            "LOOKUP",
            value1:         "CG11348",
            code1:          "A",
        },
        "#placeholderEx3b",
        {onTitleClick: "none"}
    );
</script></textarea>
        </div>
        <h2>Configuring What is Shown</h2>
        <p>
        As well as the title, by default the table will also contain export links,
        a link to the results in the originating mine, a count of the total results, and
        pages with 10 rows of results. The tables below show adjustments to these features.
        </p>
        <h3>No Export Links</h3>
        <div id="placeholderEx4a"><p>This will be where the table goes</p></div>
        <h3>No Count</h3>
        <div id="placeholderEx4b"><p>This will be where the table goes</p></div>
        <h3>No Mine Link</h3>
        <div id="placeholderEx4c"><p>This will be where the table goes</p></div>
        <h3>A Different Number of Rows</h3>
        <div id="placeholderEx4d"><p>This will be where the table goes</p></div>
        <input type="checkbox" id="example4CB" onclick="$('#example4').slideToggle();"/><label for="example4CB">View Source</label>
        <div id="example4" style="display: none;">
            <textarea rows="20" cols="80" class="coder html-snippet">
<script type="text/javascript">
    IMBedding.setBaseUrl("http://preview.flymine.org/preview");
    IMBedding.loadTemplate(
        {
            name:           "Organism_GeneDomain_new",
            size: 10,

            constraint1:    "ProteinDomain.proteins.genes.organism.name",
            op1:            "=",
            value1:         "Drosophila melanogaster",
            code1:          "A",

            constraint2:    "ProteinDomain.shortName",
            op2:            "=",
            value2:         "*homeo*",
            code2:          "B",
        },
        "#placeholderEx4a",
        {showExportLinks: false, baseUrl: flyMineBase}
    );
    IMBedding.loadTemplate(
        {
            name:           "Organism_GeneDomain_new",
            size: 10,

            constraint1:    "ProteinDomain.proteins.genes.organism.name",
            op1:            "=",
            value1:         "Drosophila melanogaster",
            code1:          "A",

            constraint2:    "ProteinDomain.shortName",
            op2:            "=",
            value2:         "*homeo*",
            code2:          "B",
        },
        "#placeholderEx4b",
        {showCount: false, baseUrl: flyMineBase}
    );
    IMBedding.loadTemplate(
        {
            name:           "Organism_GeneDomain_new",
            size: 10,

            constraint1:    "ProteinDomain.proteins.genes.organism.name",
            op1:            "=",
            value1:         "Drosophila melanogaster",
            code1:          "A",

            constraint2:    "ProteinDomain.shortName",
            op2:            "=",
            value2:         "*homeo*",
            code2:          "B",
        },
        "#placeholderEx4c",
        {showMineLink: false, baseUrl: flyMineBase}
    );
    IMBedding.loadTemplate(
        {
            name:           "Organism_GeneDomain_new",
            size: 15,

            constraint1:    "ProteinDomain.proteins.genes.organism.name",
            op1:            "=",
            value1:         "Drosophila melanogaster",
            code1:          "A",

            constraint2:    "ProteinDomain.shortName",
            op2:            "=",
            value2:         "*homeo*",
            code2:          "B",
        },
        "#placeholderEx4d",
        {baseUrl: flyMineBase}
    );
</script></textarea>
        </div>

    </div>

    <div id="tabs-2">
        <h2>Loading an Arbitrary Query</h2>
        <p>
        This tool is designed to help you write javascript functions for your pages
        by generating the code for you. You can paste in xml, experiment with 
        JSON, or build a query from scratch. You can then see the generated code, 
        and cut and paste it into your own page.
        </p>
        <p> 
        Queries can be passed to the loading function as either an xml text string,
        or as a json object. The loading module must be prepared with the base url
        before-hand in either case. 
        </p><p>
        You can either define your query using the form below, 
        or simply paste in some XML/JSON. When you press <em>"Load Query"</em>
        the results will be loaded, and the corresponding code will be generated
        for you to cut and paste into your own page (just click on the 
        <em>"Show the code"</em> button.)
        </p>
        <input type="checkbox" id="formatDetailsCB" onclick="$('#formatDetails').slideToggle('fast', function(){});"/><label for="formatDetailsCB">see information about the formats</label>
        <div id="query-radios" style="display: inline; float: right;">
            <input class="querier" type="radio" value="querybuilder" id="querybuilder-opt" name="query"/><label for="querybuilder-opt">Build A Query</label>
            <input class="querier" type="radio" checked="true" value="cutandpaste" id="cutandpaste-opt" name="query"/><label for="cutandpaste-opt">Paste in some XML/JSON</label>
        </div>
        <div id="formatDetails" style="display: none;">
            <p>
            Your query is ultimately passed to the mine as xml, which has a 
            well defined format. We have information available on <a 
            href="http://www.intermine.org/wiki/QueryXmlFormat">the xml format</a>,
            in addition to a 
            <a href="http://www.intermine.org/browser/trunk/intermine/webapp/main/resources/webapp/webservice/query.xsd">formal definition</a>.
            </p><p>
            The json object format is basically the same, except that its 
            view is expected to be an array and it has arrays of <code>joins</code> 
            and <code>constraints</code> in the place of the repeated 
            <code>join</code> and <code>constraint</code> xml tags. Also: 
            it accepts <code>from</code> as a synonym for <code>model</code>, 
            <code>where</code> as a synonym for <code>constraints</code>, 
            and <code>select</code> as a synonym for <code>view</code> 
            (as in the example below). The json object format will also correctly
            interpret <code>&lt;</code> and <code>&gt;</code> when used as operators,
            whereas the xml will have to be correctly formatted by hand.
            </p><p>
            Click <a href="http://intermine.org/wiki/WebService#a2.1Querywebservice">here</a> for 
            detailed information on the query webservice api.
            </p>
        </div>
        <div id="cutandpaste">
            <p>
            You can simply paste in xml or json into the appropriate box below, press
            load, and see the results, and the generating code for them.
            </p>
            <label for="boxselector">Use: </label>
            <select id="boxselector">
                <option value="xml" checked="true">Use XML</option>
                <option value="json" >Use JSON</option>
            </select>
            <table>
                <tr>
                    <td>
                        <textarea class="coder" id="xmlarea" rows="15"  cols="60">
<query name="" model="genomic" view="Gene.homologues.type Gene.homologues.gene.primaryIdentifier Gene.homologues.inParanoidScore Gene.homologues.homologue.primaryIdentifier Gene.homologues.homologue.organism.shortName" sortOrder="Gene.homologues.type asc">
  <constraint path="Gene.primaryIdentifier" op="&amp;lt;" value="D"/>
  <constraint path="Gene.primaryIdentifier" op="&amp;gt;" value="C"/>
</query></textarea>
                    </td>
                    <td>
                        <textarea disabled="true" class="coder" id="jsonarea" rows="15" cols="60">
{
    select: [
        "Gene.homologues.type", 
        "Gene.homologues.gene.primaryIdentifier", 
        "Gene.homologues.inParanoidScore", 
        "Gene.homologues.homologue.primaryIdentifier", 
        "Gene.homologues.homologue.organism.shortName"
    ],
    from: "genomic",
    where: [
        {path: "Gene.primaryIdentifier", op: "&lt;", value: "D"},
        {path: "Gene.primaryIdentifier", op: "&gt;", value: "C"}
    ]
}</textarea>
                    </td>
                </tr>
            </table>
        </div>
        <div class="option-box" id="querybuilder" style="display: none;">
            
    <form id="root-class-form">
        <p><label for "root-class"><em>Construct a query for</em></label>
        <select id="root-class">
        </select></p>
    </form>
    <div class="option-box">
        <h3 class="querybuilder-section-header">Views</h3>
        <form id="views-form">
            <table id="querybuilder-views">
            </table>
        </form>
        <button id="view-adder">Add a view</button>
        <span id="sortOrderDiv" style="display: none">
            <label for="sortOrderSelector">Sort by:</label>
            <select id="sortOrderSelector">
            </select>
            <span id="sortDirectionDiv">
                <input type="radio" name="sortDirection" value="ASC" id="sortASC"
                    checked="true"/>
                <label for="sortASC">ascending</label>
                <input type="radio" name="sortDirection" value="DESC" id="sortDESC"/>
                <label for="sortDESC">descending</label>
            </span>
        </span>
    </div>
    <div class="option-box">
        <h3 class="querybuilder-section-header">Constraints</h3>
        <form id="constraints-form">
            <table id="querybuilder-constraints">
            </table>
        </form>
        <button id="constraint-adder">Add a constraint</button>
        <span id="logic-box" style="display: none">
            <label for="logic-text">Logic</label>
            <input type="text" placeholder="specify logic here" id="logic"/>
        </span>
    </div>
    <div class="option-box">
        <h3 class="querybuilder-section-header">Joins</h3>
        <form id="joins-form">
            <table id="querybuilder-joins">
            </table>
        </form>
        <button id="join-adder">Add a join</button>
    </div>
    </div>
    <button id="query-loader">Load Query</button>
    <input type="checkbox" id="showQueryCode"/><label for="showQueryCode">View Generated Code</label>
    <div id="codeContainer" style="display: none">
    <div id="codeDisplay" class="ui-state-highlight ui-corner-all">
        <p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span><strong>Patience please</strong> - there isn't any code to display just yet. Just load a query and the corresponding code will be generated and displayed in this box</p>
    </div>
    </div>
    <form>
        <div class="styles" style="float: right;">
            <input class="styler" type="radio" value="bold" id="bold-q" name="style"checked="true"/>
                <label for="bold-q">Bold</label>
            <input class="styler" type="radio" value="dark" id="dark-q" name="style" />
                <label for="dark-q">Dark</label>
            <input class="styler" type="radio" value="light" id="light-q" name="style"/>
                <label for="light-q">Light</label>
        </div>
    </form>
    <div id="placeholder2"><p>The query defined above will go here</p></div>
    </div>

    <div id="tabs-3">
        <h2>Loading a Template</h2>
        <p>
        This tool is designed to help you write javascript functions to load desired
        query results. It will generate code you can cut and paste into your web page
        to embed query results. Press <em>"Show Source"</em> to see the code generated 
        for each query.
        <p>
        Enter a template name to see the list of templates for this mine. 
        Selecting one will bring up a form for you to enter the values for 
        the parameters that this template expects. 
        </p>
        <input type="checkbox" id="templateDetailsCB" onclick="$('#templateDetails').slideToggle('fast', function(){});"/><label for="templateDetailsCB">see information about templates</label>
        <div id="templateDetails" style="display: none;">
            <p>
            Templates are predefined queries with a fixed number of parameters. 
            If you are familiar with BioMart, they are very similar in functionality 
            to BioMart queries, in that they expect certain parameters and always 
            return certain types of data. Each mine has a list of templates
            which are preconfigured and accessible to the public - you can always 
            write your own as well: for a tutorial on writing your own templates 
            from scratch see  <a href="http://intermine.org/wiki/TemplateTutorial">
            here</a>.
            </p><p>
            Click <a href="http://intermine.org/wiki/WebService#a2.2Templatewebservice">here</a> for 
            detailed information on the template webservice api.
            </p>
        </div>
        <div class="option-box">
            <form id="template-form">
                <p><label for="templateName">Template Name: </label>
                <input spellcheck="false" size="50" type="text" name="name" id="templateName" placeholder="Enter a template Name" /></p>
                <div id="templateSpecific"></div>
                <br/>
                <input type="button" name="loadTemplate" value="Load Template" onclick="loadUserTemplate()" />
                <input type="checkbox" id="showTemplateCode"/><label for="showTemplateCode">View Generated Code</label>
            </form>
            <div id="templateCodeContainer" style="display: none">
                <div id="templateCodeDisplay"  class="ui-state-highlight ui-corner-all">
    <p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span><strong>Patience please</strong> - there isn't any code to display just yet. Just load a query and the corresponding code will be generated and displayed in this box</p>
            </div>
            </div>
        </div>
    <form>
        <div class="styles" style="float: right;">
            <input class="styler" type="radio" value="bold" id="bold-t" name="style"checked="true"/>
                <label for="bold-t">Bold</label>
            <input class="styler" type="radio" value="dark" id="dark-t" name="style" />
                <label for="dark-t">Dark</label>
            <input class="styler" type="radio" value="light" id="light-t" name="style"/>
                <label for="light-t">Light</label>
        </div>
    </form>
        <div id="placeholder3"><p>The template results will go here</p></div>
    </div>


    <div id="tabs-4">
        <h2>Other ways to use the data you get back</h2>
        <p> 
        The previous examples all demonstrate the default functionality, where
        a table is inserted into the page at the location of the given selector string.
        However, any arbitrary behaviour is possible by passing a function instead of
        a selector. The examples below demonstrate some potential applications of this, with 
        two graphs and an alternative tabular display.
        </p><p>
        One difference between this and the default behaviour is the fact that you will need
        to specify a result format. The two that will be most useful are 
        <a href='#'>jsonpobjects</a>, which all these examples use, and 
        <a href='#'>jsonprows</a>, which is similar but provides less syntactic sugar
        for accessing fields of the result items.
        </p>
        <div class="option-box">
        <form>
            <span style="float: right"><input type="checkbox" id="showMeGraphCode" /><label for="showMeGraphCode">Show the code</label></span>
            <div id="graph-radios">
                <input class="grapher" type="radio" id="graph1" name="graph"/><label for="graph1">Employee Age Distribution</label>
                <input class="grapher" type="radio" id="graph2" name="graph"/><label for="graph2">Manager Age vs Seniority</label>
                <input class="grapher" type="radio" id="graph3" name="graph"/><label for="graph3">Department Summary</label>
            </div>
        </form>
        <div id="showGraphAreaContainer" style="display: none;">
        <textarea rows="20" cols="80" id="showGraphArea" class="coder js-snippet">
function loadGraph1() {
    IMBedding.loadQuery(
        {
            select: ["Employee.age", "Employee.department.company.name"],
            from: "testmodel"
        },
        {size: 1000, format: "jsonpobjects"},
        function(resultSet) {
            var graphData = [];
            var ageSum = 0;
            var countAtAgeAtCompany = {};
            for (i in resultSet.results) {
                var employee = resultSet.results[i];
                var age = employee.age;
                var company = employee.department.company.name
                ageSum += age;
                if (! countAtAgeAtCompany[company]) {
                    countAtAgeAtCompany[company] = {};
                }
                if (! countAtAgeAtCompany[company][age]) {
                    countAtAgeAtCompany[company][age] = 1;
                } else {
                    countAtAgeAtCompany[company][age] 
                        = countAtAgeAtCompany[company][age] + 1;
                }
            }
            for (name in countAtAgeAtCompany) {
                var company = countAtAgeAtCompany[name];
                var count = 0;
                var sum = 0;
                var companyData = {
                    data: []
                }
                for (age in company) {
                    count += company[age];
                    sum += age * company[age];
                    companyData.data.push([age, company[age]]);
                }
                var companyAverage = parseInt(sum / count);
                companyData.label = 
                    name + " [av: " + companyAverage + "]";
                graphData.push(companyData);
            }
            var options = {
                series: {
                    stack: true,
                    lines: {show: false},
                    bars: {show: true, barWidth: 0.9},
                },
                legend: {position: "nw"}
            };
            var plot = $.plot("#graph", graphData, options);
            var averageAge = parseInt(ageSum / resultSet.results.length);
            $('<span></span>').html("Age (average:" + averageAge + ")")
                              .addClass("axis-label").appendTo('#graph');
        }
    );
}

function loadGraph2() {
    IMBedding.loadQuery(
        {
            select: ["Manager.age", "Manager.seniority", "Manager.name"],
            where: [{path: "Manager.age", op: ">", value: 30}],
            from: "testmodel"
        },
        {size: 1000, format: "jsonpobjects"},
        function(resultSet) {
            var graphData = [];
            var managers = {};
            var ageVsSen = {
                label: "Seniority by Age",
                color: "rgb(0, 115, 234)",
                points: {show: true},
                data: []
            };
            var trendLine = {
                label: "Trend Line",
                color: "rgb(255, 0, 132)",
                lines: {show: true},
            };
            for (i in resultSet.results) {
                var manager = resultSet.results[i];
                var seniority =manager.seniority;
                var age = manager.age;
                ageVsSen.data.push([age, seniority]);
                managers[age + "-" + seniority] = manager;
            }
            trendLine.data = findLineByLeastSquares(ageVsSen.data);
            graphData.push(ageVsSen);
            graphData.push(trendLine);
            var options = {
                grid: {hoverable: true, clickable: true},
                legend: {position: "nw"}
            };
            var plot = $.plot("#graph", graphData, options);
            $('#graph').bind("plothover", function(event, pos, item) {
                if (item) {
                    $("#tooltip").remove();
                    var x = item.datapoint[0].toFixed(2),
                        y = item.datapoint[1].toFixed(2);
                    var key = parseInt(x) + "-" + parseInt(y);
                    var manager = managers[key];
                    showTooltip(item.pageX, item.pageY, manager.name);
                }
                else {
                    $("#tooltip").remove();
                    previousPoint = null;            
                }
            }).bind("plotclick", function(event, pos, item) {
                if (item) {
                    var x = item.datapoint[0].toFixed(2),
                        y = item.datapoint[1].toFixed(2);
                    var key = parseInt(x) + "-" + parseInt(y);
                    var manager = managers[key];
                    var url = baseUrl + "/objectDetails.do?id=" 
                                + manager.objectId;
                    window.location.replace(url);
                }
            });
            $('<span></span>').html("Age").addClass("axis-label").appendTo('#graph');
        }
    );
}

function loadDepartmentSummary(departmentName) {
    departmentName = departmentName || "Sales";
    IMBedding.loadQuery(
        {
            select: [
                "Department.name", "Department.company.name", 
                "Department.employees.name", 
                "Department.employees.age", 
                "Department.employees.address.address", 
                "Department.manager.name",
                "Department.company.departments.name"
            ],
            where: [
                {
                    path: "Department.name", 
                    op: "=", value: departmentName
                },
                {
                    path: "Department.company.name", 
                    op: "=", value: "Wernham-Hogg"
                }
            ],
            from: "testmodel"
        },
        {size: 1000, format: "jsonpobjects"},
        function(resultSet) {
            var department = resultSet.results[0];
            var summary = $('<div></div>').addClass("department-summary");
            var title = document.createElement("h2");
            title.appendChild(document.createTextNode(
                        department.company.name + ": "));
            var depSelect = document.createElement("select");
            $(depSelect).button();
            var noOfDeps = department.company.departments.length;
            for (var i = 0; i < noOfDeps; i++) {
                var dep = department.company.departments[i];
                var depOption = document.createElement("option");
                if (dep.objectId == department.objectId) {
                    depOption.selected = true;
                }
                depOption.innerHTML = dep.name;
                depSelect.appendChild(depOption);
            }
            title.appendChild(depSelect);
            $(depSelect).change(function() {
                loadDepartmentSummary($(depSelect).val());
            });
            summary.append(title);
            var subtitle = document.createElement("h3");
            subtitle.innerHTML = "Manager: " + department.manager.name;
            summary.append(subtitle);
            var employeeCount = department.employees.length;
            var list = document.createElement("ul");
            for (var i = 0; i < employeeCount; i++) {
                var employee = department.employees[i];
                if (employee.objectId == department.manager.objectId) {
                    continue;
                }
                var item = document.createElement("li");
                var link = document.createElement("a");
                link.href = baseUrl + "/objectDetails.do?id=" 
                                    + employee.objectId;
                link.innerHTML = employee.name;
                item.appendChild(link);
                $(link).hover(
                    getEmployeeTooltipper(employee),
                    function(event) {
                        $('.tooltip').remove();
                    }
                );
                list.appendChild(item);
            }
            summary.append(list);
            $('#graph').empty().append(summary);
        }
    );
};
</textarea>
        </div>
        </div>
        <div id="graph" style="width: 600px; height: 300px;"><p>This will be where the graph goes</p></div>
    </div>
    <div id="tabs-7">
        <h2>Styling The Tables</h2>
        <p> 
        The tables produced with the imbedding.js library are designed to be easily stylable. 
        Customisation is possible by using the classes that the elements are decorated with:
        </p>
        <span class="normal-color">Classes you can style in an embedded table:</a>
        <ul>
            <li class="resource">.imbedded-table-container: <span class="normal-color">The outer container that holds the table</span></li>
            <li class="resource">.imbedded-table-titlebox: <span class="normal-color">The box that holds the title and count</span></li>
            <li class="resource">.imbedded-table-title: <span class="normal-color">The text with the actual title</span></li>
            <li class="resource">.imbedded-table: <span class="normal-color">The table element</span></li>
            <li class="resource">.imbedded-column-header-row: <span class="normal-color">The row with the column headings</span></li>
            <li class="resource">.imbedded-cell: <span class="normal-color">Each cell of the table</span></li>
            <li class="resource">.imbedded-row-odd: <span class="normal-color">Odd numbered table rows</span></li>
            <li class="resource">.imbedded-row-even: <span class="normal-color">Even numbered table rows</span></li>
            <li class="resource">.imbedded-column-odd: <span class="normal-color">Odd numbered table columns</span></li>
            <li class="resource">.imbedded-column-even: <span class="normal-color">Even numbered table columns</span></li>
            <li class="resource">.imbedded-exportlink: <span class="normal-color">The CSV and TSV export links</span></li>
            <li class="resource">.imbedded-pagelink: <span class="normal-color">The previous/next paging links</span></li>
            <li class="resource">.imbedded-mineresultslink: <span class="normal-color">The link to the results in the originating mine</span></li>
            <li class="resource">.imbedded-prev: <span class="normal-color">The previous paging link</span></li>
            <li class="resource">.imbedded-next: <span class="normal-color">The next paging link</span></li>
        </ul>
        <p>
        There are three styles supplied here with the tutorial, and you can see how changing them
        changes the appearance of the table below:
        </p>
        <form>
            <div class="styles" style="float: right">
                <input class="styler" type="radio" value="bold" id="bold-style" name="style"checked="true"/>
                <label for="bold-style">Bold</label>
                <input class="styler" type="radio" value="dark" id="dark-style" name="style" />
                    <label for="dark-style">Dark</label>
                <input class="styler" type="radio" value="light" id="light-style" name="style"/>
                    <label for="light-style">Light</label>
            </div>
        </form>
        <div id="styleDemo" ></div>
    </div>
    <div id="tabs-5">
        <h2>You May Be Interested In</h2>
        <ul>
            <li class="resource">
                <a href="http://jquery.com">jQuery</a>
                <p> 
                A powerful javascript framework this site makes extensive use of
                </p>
            </li>
            <li class="resource">
                <a href="http://code.google.com/p/jquery-jsonp/">jQuery-JSONP</a>
                <p> 
                A an extension to jQuery to improve jsonp requests (through the 
                addition of better error handling).
                </p>
            </li>
            <li class="resource">
                <a href="http://jquery-ui.com">jQuery-UI</a>
                <p>
                User interface extensions to jQuery. Used here for tabs, buttons
                and autocomplete.
                </p>
            </li>
            <li class="resource">
                <a href="http://www.oriontransfer.co.nz/software/jquery-syntax/index.en">jQuery-Syntax</a>
                <p>
                Used here for syntax highlighting in the code demonstration boxes.
                </p>
            </li>
            <li class="resource">
                <a href="http://code.google.com/p/flot/">Flot</a>
                <p>
                The library used to generate the graphs on the 
                "other things you can do with data" tab.
                </p>
            </li>
            <li class="resource">
                <a href="http://code.google.com/apis/webfonts/">Google Font API</a>
                <p>
                A webservice for supplying beautiful web-fonts so you don't have
                to do the messy business of hosting them.
                </p>
            </li>
        </ul>
    </div>
    <div id="tabs-6">
        <h2>Questions You Might Reasonably Ask</h2>
        <p>
        Nobody's asked any questions yet, but if they had, I would think these
        would be the top of the list:
        <div id="faq">
        <h3><a href="#">Can anyone use these features?</a></h3>
        <div>
            <p>
            Anyone on any server can access these embedding features. There were
            principally designed for use by groups that have mines in addition to
            other sites, which wanted better sharing of data and functionality
            between the two webapps they run, and to help with interconnections
            between different mines - but you do not have to have a mine yourself
            to make use of these features. They are as accessible as any webservice 
            request; ie: they are open to the public, and not rate-limited.
            </p>
        </div>
        <h3><a href="#">What if I don't want the opening/closing behaviour?</a></h3>
        <div>
            <p>
            The simplest way is to pass an option to the loader method:
            </p>
            <textarea rows="5" cols="20" class="coder js-snippet">
IMBedding.loadQuery(query, data, placeholder, {onTitleClick: null});</textarea>
            <p> 
            Possible values for this are "collapse" (the default) and "mine" 
            (request the title be a link to the same results table in the 
            originating mine). Entering "null" means neither behaviour would 
            occur. If you choose "mine", then the then redundant "View in Mine"
            link would not be inserted.
            </p>
        </div>
        <h3><a href="#">What if don't want the export urls?</a></h3>
        <div>
            <p> 
            As above, this can be specified by option. In this case you use the option
            "showExportLinks", which expects a boolean value.
            </p>
            <textarea rows="5" cols="20" class="coder js-snippet">
IMBedding.loadQuery(query, data, placeholder, {showExportLinks: false});</textarea>
        </div>
        </div>
    </div>
</div>
        <div id="xml-string" style="display: none;">
            <query name="employeesOfACertainAge" model="testmodel" 
                view="Employee.name Employee.age" >
                <constraint path="Employee.age" code="A" editable="true" 
                description="First age constraint" op="&gt;" value="30"></constraint>
                <constraint path="Employee.age" code="B" editable="true" 
                    description="Second age constraint" op="&lt;=" value="60"></constraint>
            </query>
        </div>
    </div>
    </body>
</html>
