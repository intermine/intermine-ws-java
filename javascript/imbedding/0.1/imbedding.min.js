IMBedding=function(){var q=null,j={},t=function(a){return a%2==0?"imbedded-column-even":"imbedded-column-odd"},z={openOnLoad:false,throbberSrc:"images/throbber.gif",onTitleClick:"collapse",showExportLinks:true,showCount:true,previousText:"Previous",nextText:"Next",showMineLink:true},r=function(a,b){var d=document.getElementById(a),c=document.getElementById(b);if(d.offsetWidth>c.offsetWidth){if(!c.defaultWidth)c.defaultWidth=c.offsetWidth;c.style.width=d.offsetWidth+1+"px"}else if(d.offsetWidth==0)if(c.defaultWidth)c.style.width=
c.defaultWidth+"px"},A=function(a,b,d){return function(){var c=j[d],e=function(){$("#imbedded-csvlink-"+d).toggle();$("#imbedded-tsvlink-"+d).toggle();$("#imbedded-mineresultslink-"+d).toggle();$("#"+a).fadeToggle("slow",function(){r(a,b);p(d)})};c.isFilledIn?e():$.jsonp({url:m(c.pagePath,c.options),success:function(g){s(d,g,c.options);e()},callbackParameter:"callback"})}},p=function(a){if($("#imbedded-table-"+a).is(":visible")){var b=j[a],d=$("#imbedded-nextlink-"+a);a=$("#imbedded-prevlink-"+a);
b.nextLink=u(b.pagePath,b.count,b.start,b.size,b.options);var c;c=Math.max(0,b.start-b.size);c=m(b.pagePath,b.options)+"&start="+c;b.prevLink=c;b.start>0?a.show():a.hide();b.lastRow>=b.count?d.hide():d.show()}else{b=$("#imbedded-nextlink-"+a);d=$("#imbedded-prevlink-"+a);b.hide();d.hide()}},D=function(a,b,d){var c=jQuery.extend({},z,d),e=(new Date).getTime()+"-"+Math.floor(Math.random()*1001);e=e.replace(/\s+/g,"");j[e]={options:c};var g=document.createElement("div");g.setAttribute("class","imbedded-table-container");
g.id="imbedded-table-container-"+e;d=document.createElement("div");d.setAttribute("class","imbedded-table-titlebox");var k=document.createElement("a");k.className="imbedded-table-title";k.appendChild(document.createTextNode(a.title));if(c.showCount){var f=document.createElement("span");f.id="imbedded-count-displayer-"+e;k.appendChild(f)}d.appendChild(k);g.appendChild(d);f=document.createElement("a");f.id="imbedded-nextlink-"+e;f.setAttribute("class","imbedded-pagelink imbedded-next");f.href=b;j[e].nextLink=
u(a.current,null,a.start,a.size,c);$(f).click(function(){$.jsonp({url:j[e].nextLink,callbackParameter:"callback",success:function(l){s(e,l,c);p(e);r(i.id,g.id)}})});f.innerHTML=c.nextText;g.appendChild(f);var h=document.createElement("a");h.id="imbedded-prevlink-"+e;h.setAttribute("class","imbedded-pagelink imbedded-prev");if(!c.openOnLoad){h.style.display="none";f.style.display="none"}h.href=b;$(h).click(function(){$.jsonp({url:j[e].prevLink,callbackParameter:"callback",success:function(l){s(e,l,
c);p(e);r(i.id,g.id)}})});h.innerHTML=c.previousText;g.appendChild(h);a.start<=0&&$(h).hide();var i=document.createElement("table");i.setAttribute("start",a.start);j[e].start=a.start;j[e].lastRow=a.size;j[e].size=a.size;i.setAttribute("lastrow",a.size);i.setAttribute("size",a.size);i.id="imbedded-table-"+e;$.jsonp({url:m(a.count,c),success:function(l){c.showCount&&$("#imbedded-count-displayer-"+e).html(" ("+l.count+" results)");j[e].count=l.count;p(e)},callbackParameter:"callback"});i.className="imbedded-table";
j[e].pagePath=a.current+"&size="+a.size;j[e].isFilledIn=false;f=document.createElement("tr");f.setAttribute("class","imbedded-table-row imbedded-column-header-row");h=a.views.length;var n=document.createElement("td");n.setAttribute("class","imbedded-cell imbedded-column-header");f.appendChild(n);for(n=0;n<h;n++){var o=document.createElement("td");o.setAttribute("class","imbedded-cell imbedded-column-header");o.innerHTML=a.columnHeaders[n];f.appendChild(o)}i.appendChild(f);g.appendChild(i);if(c.showExportLinks){f=
document.createElement("a");f.id="imbedded-csvlink-"+e;f.setAttribute("class","imbedded-exportlink");f.href=m(a.csv_url,c);f.innerHTML="Export as CSV file";g.appendChild(f);h=document.createElement("a");h.id="imbedded-tsvlink-"+e;h.setAttribute("class","imbedded-exportlink");h.href=m(a.tsv_url,c);h.innerHTML="Export as TSV file";g.appendChild(h);if(!c.openOnLoad){f.style.display="none";h.style.display="none"}}if(c.showMineLink&&c.onTitleClick!="mine"){f=document.createElement("a");f.target="_blank";
f.id="imbedded-mineresultslink-"+e;f.setAttribute("class","imbedded-mineresultslink");f.href=m(a.mineResultsLink,c);f.innerHTML="View in Mine";g.appendChild(f);if(!c.openOnLoad)f.style.display="none"}i.style.display="none";jQuery(b).empty().append(g);if(c.openOnLoad)$.jsonp({url:m(j[e].pagePath,c),success:function(l){s(e,l,c);$(i).fadeToggle();r(i.id,g.id);p(e)},callbackParameter:"callback"});else{b=document.createElement("img");b.src=c.throbberSrc;$(i).append(b)}if(c.onTitleClick=="collapse"){k.href=
"#"+g.id;jQuery(d).click(A(i.id,g.id,e))}else if(c.onTitleClick=="mine"){k.href=m(a.mineResultsLink,c);k.target="_blank"}jQuery(k).hover(function(l){var B=l.pageX;l=l.pageY;var C=a.description;$("<div></div>").html(C).attr("id","imtooltip").addClass("imbedded-table-tooltip").appendTo("body").css({position:"absolute",display:"none",top:l+10,left:B+10}).fadeIn(200);document.getElementById("imtooltip")},function(){jQuery(".imbedded-table-tooltip").remove()})},u=function(a,b,d,c,e){b=b!=null?Math.min(b,
d+c):d+c;return m(a,e)+"&start="+b},s=function(a,b,d){var c=jQuery("#imbedded-table-"+a);c.children("tbody").detach();c.children("img").detach();for(var e=b.results.length,g=0;g<e;g++){var k=document.createElement("tr");k.setAttribute("class","imbedded-table-row imbedded-data-row "+(g%2==0?"imbedded-row-even":"imbedded-row-odd"));var f=document.createElement("td");f.setAttribute("class","imbedded-cell "+t(0));f.innerHTML=g+1+parseInt(b.start);k.appendChild(f);f=b.results[g].length;for(var h=0;h<f;h++){var i=
b.results[g][h],n=document.createElement("td");n.setAttribute("class","imbedded-cell "+t(h));if(i.value){var o=document.createElement("a");o.target="_blank";o.href=m(i.url,d);o.innerHTML=i.value;n.appendChild(o)}else n.innerHTML="[NONE]";k.appendChild(n)}c.append(k)}j[a].start=b.start;j[a].lastRow=e+b.start;j[a].isFilledIn=true;IMBedding.afterBuildTable(a,b)},m=function(a,b){var d;d=b&&"baseUrl"in b?b.baseUrl:q;if(!d.match(/\/$/)&&!a.match(/^\//))d+="/";return d+a},E=function(a,b){return a instanceof
Function?a:function(d){D(d,a,b)}},F=function(a,b){b=="error"?alert("Something was wrong with your query - please edit it"):alert(b)},v=function(a,b,d,c){d=E(d,c);if(!b.format)b.format="jsonptable";if(!b.size&&b.format=="jsonptable")b.size=10;$.jsonp({url:a,data:b,success:d,callbackParameter:"callback",error:F})},x=function(a){for(var b="",d=0;d<a.length;d++){var c=a[d],e="<constraint ";for(attr in c)e+=attr+'="'+(c[attr]in w?w[c[attr]]:c[attr])+'" ';e+="/>";b+=e}return b},y=function(a){if(typeof a==
"string")return a;else if(a instanceof Object){var b='<query model="';if("model"in a)b+=a.model;else if("from"in a)b+=a.from;else throw"No model in query";b+='" view="';if("view"in a)b+=a.view.join(" ");else if("select"in a)b+=a.select.join(" ");else throw"No view in source";b+='" ';if("constraintLogic"in a)b+='constraintLogic="'+a.constraintLogic+'" ';if("sortOrder"in a)b+='sortOrder="'+a.sortOrder+'" ';b+=">";if("joins"in a)for(var d=0;d<a.joins.length;d++){var c=a.joins[d],e="<join ";for(attr in c)e+=
attr+'="'+c[attr]+'" ';e+="/>";b+=e}if("where"in a)b+=x(a.where);if("constraints"in a)b+=x(a.constraints);b+="</query>";return b}else throw"Sorry - this only takes strings or objects";},w={"<":"&lt;",">":"&gt;","<=":"&lt;=",">=":"&gt;="};return{afterBuildTable:function(){},makeQueryXML:y,setBaseUrl:function(a){return q=a},getBaseUrl:function(){return q},loadTemplate:function(a,b,d){if("baseUrl"in a)q=a.baseUrl;var c=m("/service/template/results",d);return v(c,a,b,d)},loadQuery:function(a,b,d,c){b.query=
y(a);a=m("/service/query/results",c);return v(a,b,d,c)}}}();
